<% content_for :navbar do %>
  <li class="flex gap-1 items-center">
    <%= link_to "Settings", settings_path, class:"hover:italic" %>
  </li>
  <li class="flex gap-1 items-center">
    <%= inline_svg_tag "svg/chevron-right.svg", class: "shrink-0 h-5 w-5" %>
    <%= link_to "MCP servers", mcp_servers_path, class:"hover:italic" %>
  </li>
<% end %>

<div class="n-title-container md:flex md:justify-between md:items-center">
  <h2 class="n-main-title">MCP Servers</h2>
  <div class="flex items-center gap-2">
    <%= link_to mcp_catalog_index_path, class: "n-btn border n-main-border n-main-hover n-main-focus" do %>
      <p>Catalog</p>
    <% end %>
    <%= link_to "Add Server", new_mcp_server_path, class: "n-btn-primary" %>
  </div>
</div>

<div class="mb-4 flex gap-2">
  <%= form_with url: mcp_servers_path, method: :get, class: "flex gap-2" do |f| %>
    <%= f.select :status,
      options_for_select([
        ["All statuses", ""],
        ["Ready", "ready"],
        ["Disconnected", "disconnected"],
        ["Error", "error"],
        ["Disabled", "disabled"]
      ], params[:status]),
      {},
      class: "n-select" %>

    <%= f.select :transport_type,
      options_for_select([
        ["All types", ""],
        ["Streamable HTTP", "streamable"],
        ["SSE", "sse"],
        ["STDIO", "stdio"]
      ], params[:transport_type]),
      {},
      class: "n-select" %>

    <%= f.submit "Filter", class: "n-btn-primary" %>
    <%= link_to "Reset", mcp_servers_path, class: "n-btn-danger content-center" %>
  <% end %>
</div>

<ul class="n-cards-grid !list-none">
  <% @mcp_servers.each do |server| %>
    <li class="relative n-card n-main-border lg:col-span-2">
      <%= link_to server, class:"h-38 n-main-hover n-main-focus" do %>
        <div class="flex justify-center pt-6">
          <h5 class="n-card-title"><%= server.name %></h5>
        </div>
        <div class="flex items-center justify-center gap-2">
          <% case server.status %>
          <% when "ready" %>
            <div class="inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-800 dark:bg-green-900/30 dark:text-green-400">
              <span class="h-1.5 w-1.5 rounded-full bg-green-600"></span>
              Ready
            </div>
          <% when "error" %>
            <div class="inline-flex items-center gap-1 rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800 dark:bg-red-900/30 dark:text-red-400">
              <span class="h-1.5 w-1.5 rounded-full bg-red-600"></span>
              Error
            </div>
          <% when "connecting" %>
            <div class="inline-flex items-center gap-1 rounded-full bg-yellow-100 px-2 py-1 text-xs font-medium text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400">
              <span class="h-1.5 w-1.5 rounded-full bg-yellow-600 animate-pulse"></span>
              Connecting
            </div>
          <% else %>
            <div class="inline-flex items-center gap-1 rounded-full bg-neutral-100 px-2 py-1 text-xs font-medium text-neutral-800 dark:bg-neutral-900/30 dark:text-neutral-400">
              <span class="h-1.5 w-1.5 rounded-full bg-neutral-600"></span>
              Disconnected
            </div>
          <% end %>
          <p class="text-sm text-neutral-500 dark:text-neutral-400"><%= server.latency_ms ? "#{server.latency_ms}ms" : "-" %></p>
        </div>
      <% end %>
      <div class="absolute w-full bottom-0 px-2 pb-2 grid grid-cols-2 gap-2">
        <%= link_to edit_mcp_server_path(server), class: "bg-white dark:bg-neutral-900 n-btn n-main-hover n-main-focus border n-main-border" do %>
          <p>Edit</p>
        <% end %>
        <% if server.status_ready? %>
          <%= link_to disconnect_mcp_server_path(server), data: { turbo_method: :post }, class: "text-red-600 dark:text-red-300 bg-white dark:bg-neutral-900 n-btn n-main-hover-danger n-main-focus-danger border n-main-border" do %>
            <p>Disconnect</p>
          <% end %>
        <% else %>
          <%= link_to connect_mcp_server_path(server), data: { turbo_method: :post }, class: "text-green-600 dark:text-green-400 bg-white dark:bg-neutral-900 n-btn n-main-hover n-main-focus border n-main-border" do %>
            <p>Connect</p>
          <% end %>
        <% end %>
      </div>
    </li>
  <% end %>
</ul>
