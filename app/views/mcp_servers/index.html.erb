<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
  <div class="n-main-title-container mb-6">
    <h1 class="n-main-title">Serveurs MCP</h1>
    <div class="flex gap-2">
      <%= link_to mcp_catalog_index_path, class: "inline-flex items-center gap-2 rounded-lg bg-purple-600 hover:bg-purple-700 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors" do %>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
        </svg>
        Catalogue
      <% end %>
      <%= link_to "Ajouter un serveur", new_mcp_server_path, class: "inline-flex items-center gap-2 rounded-lg bg-green-600 hover:bg-green-700 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors" %>
    </div>
  </div>

  <%# Filtres %>
  <div class="mb-4 flex gap-2">
    <%= form_with url: mcp_servers_path, method: :get, class: "flex gap-2" do |f| %>
      <%= f.select :status,
        options_for_select([
          ["Tous les statuts", ""],
          ["Prêt", "ready"],
          ["Déconnecté", "disconnected"],
          ["Erreur", "error"],
          ["Désactivé", "disabled"]
        ], params[:status]),
        {},
        class: "rounded-lg border-gray-300 dark:border-neutral-700 dark:bg-neutral-800 text-sm" %>

      <%= f.select :transport_type,
        options_for_select([
          ["Tous les types", ""],
          ["Streamable HTTP", "streamable"],
          ["SSE", "sse"],
          ["STDIO", "stdio"]
        ], params[:transport_type]),
        {},
        class: "rounded-lg border-gray-300 dark:border-neutral-700 dark:bg-neutral-800 text-sm" %>

      <%= f.submit "Filtrer", class: "rounded-lg bg-gray-200 dark:bg-neutral-700 px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-300 dark:hover:bg-neutral-600" %>
      <%= link_to "Réinitialiser", mcp_servers_path, class: "rounded-lg bg-gray-100 dark:bg-neutral-800 px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-200 dark:hover:bg-neutral-700" %>
    <% end %>
  </div>

  <%# Liste des serveurs %>
  <div class="overflow-hidden rounded-lg border border-gray-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 shadow">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-neutral-700">
      <thead class="bg-gray-50 dark:bg-neutral-900">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Nom</th>
          <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Type</th>
          <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Endpoint</th>
          <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Statut</th>
          <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Latence</th>
          <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Activé</th>
          <th class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 dark:divide-neutral-700 bg-white dark:bg-neutral-800">
        <% @mcp_servers.each do |server| %>
          <tr class="hover:bg-gray-50 dark:hover:bg-neutral-900/50 transition-colors">
            <td class="px-6 py-4 whitespace-nowrap">
              <%= link_to server.name, server, class: "text-sm font-medium text-blue-600 dark:text-blue-400 hover:underline" %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium <%= server.transport_type == 'stdio' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400' : 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400' %>">
                <%= server.transport_type.upcase %>
              </span>
            </td>
            <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate">
              <%= server.endpoint || server.command %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <% case server.status %>
              <% when "ready" %>
                <span class="inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-800 dark:bg-green-900/30 dark:text-green-400">
                  <span class="h-1.5 w-1.5 rounded-full bg-green-600"></span>
                  Prêt
                </span>
              <% when "error" %>
                <span class="inline-flex items-center gap-1 rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800 dark:bg-red-900/30 dark:text-red-400">
                  <span class="h-1.5 w-1.5 rounded-full bg-red-600"></span>
                  Erreur
                </span>
              <% when "connecting" %>
                <span class="inline-flex items-center gap-1 rounded-full bg-yellow-100 px-2 py-1 text-xs font-medium text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400">
                  <span class="h-1.5 w-1.5 rounded-full bg-yellow-600 animate-pulse"></span>
                  Connexion
                </span>
              <% else %>
                <span class="inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-800 dark:bg-gray-900/30 dark:text-gray-400">
                  <span class="h-1.5 w-1.5 rounded-full bg-gray-600"></span>
                  Déconnecté
                </span>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              <%= server.latency_ms ? "#{server.latency_ms}ms" : "-" %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <% if server.enabled? %>
                <span class="text-green-600 dark:text-green-400">✓</span>
              <% else %>
                <span class="text-gray-400">✗</span>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
              <%= link_to "Voir", server, class: "text-blue-600 dark:text-blue-400 hover:underline" %>
              <% if server.status_ready? %>
                <%= button_to "Déconnecter", disconnect_mcp_server_path(server), method: :post, class: "inline text-orange-600 dark:text-orange-400 hover:underline" %>
              <% else %>
                <%= button_to "Connecter", connect_mcp_server_path(server), method: :post, class: "inline text-green-600 dark:text-green-400 hover:underline" %>
              <% end %>
              <%= link_to "Modifier", edit_mcp_server_path(server), class: "text-gray-600 dark:text-gray-400 hover:underline" %>
              <%= button_to "Supprimer", server, method: :delete, data: { confirm: "Êtes-vous sûr ?" }, class: "inline text-red-600 dark:text-red-400 hover:underline" %>
            </td>
          </tr>
        <% end %>

        <% if @mcp_servers.empty? %>
          <tr>
            <td colspan="7" class="px-6 py-12 text-center">
              <div class="text-gray-500 dark:text-gray-400">
                <p class="text-lg font-medium mb-2">Aucun serveur MCP</p>
                <p class="text-sm mb-4">Commencez par activer un serveur depuis le catalogue ou ajoutez-en un manuellement.</p>
                <div class="flex gap-3 justify-center">
                  <%= link_to mcp_catalog_index_path, class: "inline-flex items-center gap-2 rounded-lg bg-purple-600 hover:bg-purple-700 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors" do %>
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    Parcourir le catalogue
                  <% end %>
                  <%= link_to "Ajouter manuellement", new_mcp_server_path, class: "inline-flex items-center gap-2 rounded-lg bg-gray-200 dark:bg-neutral-700 hover:bg-gray-300 dark:hover:bg-neutral-600 px-4 py-2 text-sm font-semibold text-gray-900 dark:text-gray-100 shadow-sm transition-colors" %>
                </div>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
