<% content_for :title, "AI Chat" %>
<div class="h-[calc(100vh-10.5rem)] lg:h-full flex flex-col justify-between">
  <section class="w-full max-w-4xl mx-auto sm:pt-6 text-center overflow-y-auto">
    <h2 class="text-3xl sm:text-5xl font-extrabold tracking-tight">
      Welcome to NOSIA
    </h2>
    <p class="text-sm md:text-base mt-3 text-neutral-500 dark:text-neutral-400">
      An ethical, humanistic, and peaceful vision of free and private generative AI.
    </p>
    <div class="mt-3 lg:mt-12 flex justify-center">
      <div class="w-full bg-white dark:bg-neutral-800 shadow-sm rounded-3xl border n-main-border">
        <div data-controller="dropzone" data-action="dragenter->dropzone#highlight dragover->dropzone#highlight dragleave->dropzone#unhighlight drop->dropzone#drop click->dropzone#pick"
          class="group relative flex-wrap m-6 sm:m-8 p-3 sm:p-6 md:py-14 rounded-xl text-center transition-all border-2 border-dashed n-main-border n-main-hover n-main-focus"
          >
          <input type="file" multiple class="hidden" data-dropzone-target="input">
          <div class="mx-auto mb-4 h-12 w-12 rounded-2xl ring-1 ring-neutral-200/70 flex items-center justify-center
                      group-data-[active=true]:ring-neutral-300 transition">
            <%= inline_svg_tag "svg/download.svg", class: "h-6 w-6 text-neutral-500 dark:text-neutral-400" %>
          </div>

          <p class="text-base sm:text-lg font-semibold text-neutral-800 dark:text-white">Add any document</p>
          <p class="mt-1 text-sm text-neutral-500 dark:text-neutral-400">Click or drag’n’drop files here to upload</p>
          <p class="mt-2 text-xs text-neutral-400 dark:text-neutral-500">PDF, PNG, JPG, DOCX · max 512&nbsp;MB</p>

          <div class="pointer-events-none absolute inset-0 rounded-2xl ring-8 ring-transparent
                      group-data-[active=true]:ring-neutral-100 transition"></div>

          <ul class="mt-6 max-w-md mx-auto space-y-2 text-left hidden" data-dropzone-target="list"></ul>
        </div>
      </div>
    </div>
  </section>
  <section class="w-full max-w-4xl mx-auto">
    <div class="pointer-events-auto rounded-2xl bg-white dark:bg-neutral-800 shadow-xl ring-1 ring-neutral-200 dark:ring-neutral-700">
      <div class="px-3 sm:px-4 py-3 sm:py-4">
        <%= render "chats/form", chat: @chat %>
      </div>
    </div>
  </section>
  <%# MCP Selector Modal %>
  <% if @chat.persisted? %>
    <%= render "chats/mcp_selector", chat: @chat %>
  <% end %>

  <script>
    // Copy selected MCP servers to the chat form before submission
    document.addEventListener('turbo:load', () => {
      const form = document.getElementById('chat-form')
      if (!form) return

      form.addEventListener('submit', (e) => {
        // Get all checked MCP server checkboxes
        const checkedBoxes = document.querySelectorAll('input[name="mcp_server_ids[]"]:checked')

        // Clear existing hidden fields
        const hiddenContainer = document.getElementById('mcp-server-hidden-fields')
        if (hiddenContainer) {
          hiddenContainer.innerHTML = ''

          // Add hidden field for each selected server
          checkedBoxes.forEach(checkbox => {
            const input = document.createElement('input')
            input.type = 'hidden'
            input.name = 'mcp_server_ids[]'
            input.value = checkbox.value
            hiddenContainer.appendChild(input)
          })
        }
      })
    })
  </script>
</div>
